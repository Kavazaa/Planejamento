<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Definição de Metas 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: url('Fundo.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
        }
        /* Overlay escuro e desfocado */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(17, 24, 39, 0.7); /* Cor escura com transparência */
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: -1;
        }
        .card {
            background-color: #4C1D95; /* Cor roxa mais escura para os cards */
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid #6D28D9;
        }
        .input-field {
            background-color: #3730A3; /* Roxo mais escuro para inputs */
            color: #FBBF24; /* Amarelo para o texto do input */
            border: 1px solid #8B5CF6;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            width: 100%;
            transition: all 0.3s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: #FBBF24;
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.3);
        }
        .label-text {
            color: #E0E7FF; /* Cor lavanda para labels */
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: block;
        }
        .section-title {
            color: #FBBF24; /* Amarelo */
            font-weight: 700;
            font-size: 1.75rem;
            border-bottom: 2px solid #F59E0B;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .growth-badge {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 700;
            color: white;
            text-align: center;
            transition: all 0.5s ease;
        }
        .progress-bar-bg {
            background-color: #3730A3;
        }
        .progress-bar-fill {
            background-color: #FBBF24;
            transition: width 0.5s ease-in-out;
        }
        .save-button {
            background-color: #FBBF24;
            color: #4C1D95;
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }
        .save-button:hover {
            background-color: #F59E0B;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        /* Spinner de Carregamento */
        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top-color: #FBBF24;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Animação para piscar o fundo */
        @keyframes green-flash-animation {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgba(16, 185, 129, 0.2); } /* Verde com transparência */
        }
        .flash-green {
            animation: green-flash-animation 1.5s ease;
        }
    </style>
</head>
<body class="bg-transparent text-white p-4 sm:p-8">

    <div class="max-w-4xl mx-auto" id="pageContent">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-bold text-yellow-400">Planejador de Metas 2025</h1>
            <p class="text-indigo-200 mt-2">Defina suas metas anuais, semestrais e mensais com projeções automáticas.</p>
        </header>

        <!-- Seção 1: Meta Anual -->
        <section id="secao1" class="card">
            <h2 class="section-title">1. Definição da Meta Anual</h2>
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="space-y-6">
                    <div>
                        <label for="resultado2024" class="label-text">Resultado GMV 2024 (Fechado)</label>
                        <input type="number" id="resultado2024" class="input-field" placeholder="Ex: 100000">
                    </div>
                    <div>
                        <label for="meta2025" class="label-text">Meta GMV 2025</label>
                        <input type="number" id="meta2025" class="input-field" placeholder="Ex: 150000">
                    </div>
                </div>
                <div id="resultadoCrescimento" class="text-center p-6 bg-indigo-800 rounded-lg h-full flex flex-col justify-center items-center">
                    <h3 class="text-lg font-semibold text-yellow-300 mb-2">Crescimento da Meta</h3>
                    <div id="crescimentoPercentual" class="growth-badge bg-gray-600">
                        <span id="crescimentoValor">--%</span>
                    </div>
                    <p id="crescimentoDescricao" class="mt-3 text-indigo-200 font-medium">Preencha os valores para calcular</p>
                </div>
            </div>
        </section>

        <!-- Seção 2: Divisão por Semestre -->
        <section id="secao2" class="card">
            <h2 class="section-title">2. Divisão por Semestre (2025)</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Semestre 1 -->
                <div class="space-y-4 bg-indigo-800 p-6 rounded-lg">
                    <h3 class="text-xl font-bold text-yellow-300">Semestre 1 (Janeiro - Junho)</h3>
                    <div>
                        <label for="faturadoS1" class="label-text">Faturamento Realizado S1</label>
                        <input type="number" id="faturadoS1" class="input-field" placeholder="Preenchimento manual">
                    </div>
                    <div class="mt-4">
                        <p class="text-indigo-200 mb-2">Progresso da Meta Anual:</p>
                        <div class="w-full progress-bar-bg rounded-full h-4">
                            <div id="progressoS1Barra" class="progress-bar-fill h-4 rounded-full" style="width: 0%"></div>
                        </div>
                        <p id="progressoS1Texto" class="text-right text-yellow-400 font-bold mt-1">0%</p>
                    </div>
                </div>
                <!-- Semestre 2 -->
                <div class="space-y-4 bg-indigo-800 p-6 rounded-lg flex flex-col justify-center">
                     <h3 class="text-xl font-bold text-yellow-300">Semestre 2 (Julho - Dezembro)</h3>
                     <p class="text-indigo-200">Valor restante para bater a meta:</p>
                     <p id="valorRestanteS2" class="text-3xl font-bold text-yellow-400">R$ 0,00</p>
                     <p id="percentualRestanteS2" class="text-indigo-200 font-medium">(--% da meta anual)</p>
                </div>
            </div>
        </section>

        <!-- Seção 3: Planejamento Mensal S2 -->
        <section id="secao3" class="card">
            <h2 class="section-title">3. Planejamento Mensal do 2º Semestre (vs. Meta Anual)</h2>
            <div class="grid lg:grid-cols-4 gap-8">
                <div class="lg:col-span-3 grid sm:grid-cols-2 md:grid-cols-3 gap-6">
                    <!-- Meses de Julho a Dezembro -->
                    <div class="mes-card" data-mes="jul">
                        <h4 class="font-bold text-yellow-300">Julho</h4>
                        <input type="number" id="mes-jul-input" class="input-field mt-2 mes-input" placeholder="% da meta ANUAL">
                        <p class="valor-mes text-indigo-200 mt-1 text-sm">R$ 0,00</p>
                    </div>
                    <div class="mes-card" data-mes="ago">
                        <h4 class="font-bold text-yellow-300 flex items-center">Agosto <small class="text-indigo-300 ml-2 font-normal text-xs">(Dia dos Pais)</small></h4>
                        <input type="number" id="mes-ago-input" class="input-field mt-2 mes-input" placeholder="% da meta ANUAL">
                        <p class="valor-mes text-indigo-200 mt-1 text-sm">R$ 0,00</p>
                    </div>
                    <div class="mes-card" data-mes="set">
                        <h4 class="font-bold text-yellow-300 flex items-center">Setembro <small class="text-indigo-300 ml-2 font-normal text-xs">(Dia do Cliente)</small></h4>
                        <input type="number" id="mes-set-input" class="input-field mt-2 mes-input" placeholder="% da meta ANUAL">
                        <p class="valor-mes text-indigo-200 mt-1 text-sm">R$ 0,00</p>
                    </div>
                    <div class="mes-card" data-mes="out">
                        <h4 class="font-bold text-yellow-300 flex items-center">Outubro <small class="text-indigo-300 ml-2 font-normal text-xs">(Crianças/Halloween)</small></h4>
                        <input type="number" id="mes-out-input" class="input-field mt-2 mes-input" placeholder="% da meta ANUAL">
                        <p class="valor-mes text-indigo-200 mt-1 text-sm">R$ 0,00</p>
                    </div>
                    <div class="mes-card" data-mes="nov">
                        <h4 class="font-bold text-yellow-300 flex items-center">Novembro <small class="text-indigo-300 ml-2 font-normal text-xs">(Black Friday)</small></h4>
                        <input type="number" id="mes-nov-input" class="input-field mt-2 mes-input" placeholder="% da meta ANUAL">
                        <p class="valor-mes text-indigo-200 mt-1 text-sm">R$ 0,00</p>
                    </div>
                    <div class="mes-card" data-mes="dez">
                        <h4 class="font-bold text-yellow-300 flex items-center">Dezembro <small class="text-indigo-300 ml-2 font-normal text-xs">(Natal/Reveillon)</small></h4>
                        <input type="number" id="mes-dez-input" class="input-field mt-2 mes-input" placeholder="% da meta ANUAL">
                        <p class="valor-mes text-indigo-200 mt-1 text-sm">R$ 0,00</p>
                    </div>
                </div>
                <!-- Totalizador -->
                <div id="totalizadorS2" class="lg:col-span-1 bg-indigo-800 p-6 rounded-lg flex flex-col justify-center items-center text-center h-full">
                     <h3 class="text-lg font-semibold text-yellow-300">Status Anual Projetado</h3>
                     <p class="text-indigo-200 text-sm mb-2">Com base no realizado + planejado</p>
                     <div id="statusAnual" class="mt-1 font-bold text-2xl">--</div>
                </div>
            </div>
            <div class="mt-8 text-center">
                <button id="savePlanBtn" class="save-button">Salvar Planejamento</button>
            </div>
        </section>
    </div>

    <!-- Modal de Salvamento -->
    <div id="saveModal" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center hidden z-50 p-4">
        <div class="bg-indigo-900 border-2 border-yellow-400 p-8 rounded-2xl shadow-2xl max-w-6xl w-full relative">
            <button id="closeModalBtn" class="absolute top-4 right-4 text-white hover:text-yellow-400 text-3xl leading-none z-10">&times;</button>
            
            <h3 class="text-2xl font-bold text-yellow-400 mb-4 text-center">Enquanto salvamos seu planejamento, conheça um pouco mais sobre a Mamba Digital</h3>
            
            <!-- Player de Vídeo -->
            <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden" style="height: 60vh;">
                <iframe id="youtubePlayer" width="100%" height="100%" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>

            <!-- Status do Salvamento -->
            <div id="statusColumn" class="text-center p-4 rounded-lg transition-colors duration-500 mt-4 h-24 flex items-center justify-center">
                <div id="loadingState" class="w-full">
                    <div class="spinner"></div>
                    <p class="text-indigo-200 mt-2 text-lg">Salvando planejamento...</p>
                </div>
                <div id="successState" class="hidden w-full">
                     <h3 class="text-2xl font-bold text-green-400">Planejamento Salvo!</h3>
                     <p class="text-indigo-200">Seus dados foram guardados no navegador.</p>
                </div>
            </div>
        </div>
    </div>


    <script>
        const YOUTUBE_VIDEO_ID = 'EKUo03LwGmM';

        // --- LÓGICA DE SALVAMENTO E CARREGAMENTO ---
        const inputIds = [
                'resultado2024', 'meta2025', 'faturadoS1',
                'mes-jul-input', 'mes-ago-input', 'mes-set-input',
                'mes-out-input', 'mes-nov-input', 'mes-dez-input'
            ];

        function salvarDados() {
            const data = {};
            inputIds.forEach(id => {
                const input = document.getElementById(id);
                if (input) data[id] = input.value;
            });
            localStorage.setItem('planejamentoMetasData', JSON.stringify(data));
        }

        function carregarDadosSalvos() {
            const savedData = localStorage.getItem('planejamentoMetasData');
            if (savedData) {
                const data = JSON.parse(savedData);
                inputIds.forEach(id => {
                    const input = document.getElementById(id);
                    if (input && data[id] !== undefined) input.value = data[id];
                });
                calcularTudo();
            }
        }

        // --- LÓGICA DE CÁLCULO ---
        function formatCurrency(value) {
            if (isNaN(value) || value === null) return "R$ 0,00";
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function getDificuldadeMeta(faturamento2024, crescimento) {
            if (crescimento <= 0) return { nivel: 'Sem Crescimento', cor: 'bg-gray-600', texto: 'A meta é menor ou igual ao resultado anterior.' };
            crescimento = crescimento * 100;
            if (faturamento2024 <= 100000) {
                if (crescimento <= 100) return { nivel: 'Praticável', cor: 'bg-green-500', texto: 'Crescimento saudável.' };
                if (crescimento <= 200) return { nivel: 'Difícil', cor: 'bg-yellow-500', texto: 'Meta desafiadora.' };
                return { nivel: 'Impossível', cor: 'bg-red-600', texto: 'Meta muito agressiva.' };
            } else if (faturamento2024 <= 250000) {
                if (crescimento <= 80) return { nivel: 'Praticável', cor: 'bg-green-500', texto: 'Crescimento saudável.' };
                if (crescimento <= 150) return { nivel: 'Difícil', cor: 'bg-yellow-500', texto: 'Meta desafiadora.' };
                return { nivel: 'Impossível', cor: 'bg-red-600', texto: 'Meta muito agressiva.' };
            } else if (faturamento2024 <= 500000) {
                if (crescimento <= 60) return { nivel: 'Praticável', cor: 'bg-green-500', texto: 'Crescimento saudável.' };
                if (crescimento <= 120) return { nivel: 'Difícil', cor: 'bg-yellow-500', texto: 'Meta desafiadora.' };
                return { nivel: 'Impossível', cor: 'bg-red-600', texto: 'Meta muito agressiva.' };
            } else if (faturamento2024 <= 1000000) {
                if (crescimento <= 50) return { nivel: 'Praticável', cor: 'bg-green-500', texto: 'Crescimento saudável.' };
                if (crescimento <= 100) return { nivel: 'Difícil', cor: 'bg-yellow-500', texto: 'Meta desafiadora.' };
                return { nivel: 'Impossível', cor: 'bg-red-600', texto: 'Meta muito agressiva.' };
            } else {
                if (crescimento <= 40) return { nivel: 'Praticável', cor: 'bg-green-500', texto: 'Crescimento saudável.' };
                if (crescimento <= 70) return { nivel: 'Difícil', cor: 'bg-yellow-500', texto: 'Meta desafiadora.' };
                return { nivel: 'Impossível', cor: 'bg-red-600', texto: 'Meta muito agressiva.' };
            }
        }

        function calcularTudo() {
            const resultado2024 = parseFloat(document.getElementById('resultado2024').value) || 0;
            const meta2025 = parseFloat(document.getElementById('meta2025').value) || 0;
            const faturadoS1 = parseFloat(document.getElementById('faturadoS1').value) || 0;

            if (resultado2024 > 0 && meta2025 > 0) {
                const crescimento = (meta2025 / resultado2024) - 1;
                document.getElementById('crescimentoValor').textContent = `${Math.round(crescimento * 100)}%`;
                const dificuldade = getDificuldadeMeta(resultado2024, crescimento);
                document.getElementById('crescimentoPercentual').className = `growth-badge ${dificuldade.cor}`;
                document.getElementById('crescimentoDescricao').textContent = `${dificuldade.nivel}: ${dificuldade.texto}`;
            } else {
                document.getElementById('crescimentoValor').textContent = '--%';
                document.getElementById('crescimentoPercentual').className = 'growth-badge bg-gray-600';
                document.getElementById('crescimentoDescricao').textContent = 'Preencha os valores para calcular';
            }

            if (meta2025 > 0) {
                const percS1 = Math.min((faturadoS1 / meta2025) * 100, 100);
                document.getElementById('progressoS1Barra').style.width = `${percS1}%`;
                document.getElementById('progressoS1Texto').textContent = `${Math.round(percS1)}%`;
            } else {
                document.getElementById('progressoS1Barra').style.width = '0%';
                document.getElementById('progressoS1Texto').textContent = '0%';
            }

            const valorRestanteS2 = Math.max(0, meta2025 - faturadoS1);
            const percRestanteS2 = meta2025 > 0 ? (valorRestanteS2 / meta2025) * 100 : 0;
            document.getElementById('valorRestanteS2').textContent = formatCurrency(valorRestanteS2);
            document.getElementById('percentualRestanteS2').textContent = `(${Math.round(percRestanteS2)}% da meta anual)`;

            let totalPlanejadoPercAnual = 0;
            document.querySelectorAll('.mes-input').forEach(input => {
                const percMesAnual = parseFloat(input.value) || 0;
                totalPlanejadoPercAnual += percMesAnual;
                input.nextElementSibling.textContent = formatCurrency(meta2025 * (percMesAnual / 100));
            });
            
            // Status Anual Projetado
            const statusAnualEl = document.getElementById('statusAnual');
            const percS1 = meta2025 > 0 ? (faturadoS1 / meta2025 * 100) : 0;
            const totalProjetadoAnualPerc = percS1 + totalPlanejadoPercAnual;
            const faltaParaMetaAnual = 100 - totalProjetadoAnualPerc;

            if (meta2025 === 0) {
                statusAnualEl.innerHTML = `<span class="text-indigo-300">--</span>`;
            } else if (faltaParaMetaAnual <= 0) {
                statusAnualEl.innerHTML = `<span class="text-green-400">Meta Anual Batida!</span> <p class="text-xs font-normal text-green-300">(${Math.round(totalProjetadoAnualPerc)}% projetado)</p>`;
            } else {
                statusAnualEl.innerHTML = `<span class="text-red-400">Faltam ${Math.round(faltaParaMetaAnual)}%</span> <p class="text-xs font-normal text-red-300">para a meta anual</p>`;
            }

            salvarDados();
        }

        // --- LÓGICA DO MODAL ---
        const saveModal = document.getElementById('saveModal');
        const statusColumn = document.getElementById('statusColumn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const savePlanBtn = document.getElementById('savePlanBtn');
        const youtubePlayer = document.getElementById('youtubePlayer');
        const loadingState = document.getElementById('loadingState');
        const successState = document.getElementById('successState');

        function openModal() {
            loadingState.classList.remove('hidden');
            successState.classList.add('hidden');
            statusColumn.classList.remove('flash-green');
            youtubePlayer.src = `https://www.youtube.com/embed/${YOUTUBE_VIDEO_ID}?autoplay=1&mute=1`;
            saveModal.classList.remove('hidden');
            
            setTimeout(() => {
                loadingState.classList.add('hidden');
                successState.classList.remove('hidden');
                statusColumn.classList.add('flash-green');
            }, 10000);
        }
        
        function closeModal() {
            saveModal.classList.add('hidden');
            youtubePlayer.src = '';
        }

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', carregarDadosSalvos);
        
        inputIds.forEach(id => {
            const input = document.getElementById(id);
            if (input) input.addEventListener('input', calcularTudo);
        });

        savePlanBtn.addEventListener('click', () => {
            salvarDados(); 
            openModal();
        });
        
        closeModalBtn.addEventListener('click', closeModal);
        saveModal.addEventListener('click', (event) => {
            if (event.target === saveModal) closeModal();
        });

    </script>
</body>
</html>
